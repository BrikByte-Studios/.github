{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.brikbyte.io/brikpipe-build/v1",
  "title": "BrikByteOS Per-Language Build Config Schema (v1)",
  "description": "Schema for validating brikpipe.build.yml across all runtimes.",
  "$comment": "PIPE-BUILD-SCHEMA-TEST-004 — Add Schema Validation for Per-Language Pipeline Config",
  "type": "object",
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Version of this build config schema that the file targets (e.g. v1).",
      "default": "v1"
    },
    "language": {
      "type": "string",
      "description": "Canonical language identifier for this build config.",
      "enum": ["node", "python", "java", "dotnet", "go"],
      "$comment": "REQ-BUILD-SCHEMA-002 — Schema must enforce allowed languages."
    },
    "runtime_version": {
      "type": "string",
      "description": "Runtime version string aligned with the runtime matrix (e.g. 20, 3.11, 17, 8.0.x, 1.22.x)."
    },
    "build_command": {
      "type": "string",
      "description": "Language-specific command used to build the project.",
      "minLength": 1,
      "maxLength": 512,
      "pattern": "^[^\\r\\n]*$",
      "$comment": "Simple guardrail: no newlines in build_command to reduce injection surface."
    },
    "test_command": {
      "type": "string",
      "description": "Language-specific command used to run the main test suite.",
      "minLength": 1,
      "maxLength": 512,
      "pattern": "^[^\\r\\n]*$",
      "$comment": "REQ-BUILD-SCHEMA-001 — Config MUST define required build keys."
    },
    "output_dir": {
      "type": "string",
      "description": "Relative path to the primary build output directory (dist, build, target, bin/Release, etc.).",
      "minLength": 1
    },
    "cache_paths": {
      "type": "array",
      "description": "Optional list of cache paths (relative or absolute) to be reused by CI.",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "env_files": {
      "type": "array",
      "description": "List of environment or configuration files used during build/test.",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata for humans and tools (e.g., owning team, service name).",
      "properties": {
        "service_name": {
          "type": "string",
          "description": "Human-readable service name."
        },
        "owner": {
          "type": "string",
          "description": "Owning team or squad identifier."
        },
        "tags": {
          "type": "array",
          "description": "Free-form tags, e.g. [\"experimental\", \"internal\"].",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    }
  },
  "required": [
    "language",
    "runtime_version",
    "build_command",
    "test_command",
    "output_dir"
  ],
  "additionalProperties": false
}
