# BrikByte Studios — Org-wide Governance Policy (PIPE-GOV-7.1)
#
# This file defines the **baseline governance policy** for BrikByte-Studios.
# Product / service repos MAY define their own .github/policy.yml, but:
#   - They MUST conform to docs/policy/policy.schema.json
#   - They SHOULD be at least as strict as this baseline (see policy-validate.js lint rules)

version: 1                # Schema version (not policy_version)
policy_version: "1.0.0"   # Policy version (semver)
mode: "advisory"          # advisory | enforce

reviews:
  # Legacy baseline (still used by tools as global minimums)
  required_approvals: 2
  require_code_owner_review: true
  additional_reviewer_teams:
    - "platform-leads"

  # New: default rule (optional but recommended)
  default:
    required_approvals: 2
    require_code_owner_review: true
    required_roles: [] # none globally

  # New: branch-specific rules
  branches:
    main:
      required_approvals: 2
      require_code_owner_review: true

    "release/*":
      required_approvals: 2
      require_code_owner_review: true

    "hotfix/*":
      required_approvals: 2
      required_roles:
        - "platform-leads"

    "feature/*":
      required_approvals: 1
      require_code_owner_review: false

tests:
  # Absolute minimum coverage for org-wide protected branches (non-relaxable baseline).
  coverage_min: 80
  # Require all tests to be green.
  require_tests_green: true
  # For v1, this is informational only; future versions may narrow coverage checks to critical paths.
  critical_paths_only: false

  # Allowed drop vs baseline in percentage points.
  # Example: -2 means “may drop by at most 2 percentage points”.
  coverage_delta_min: -2

  # Where CI will write the coverage summary JSON (relative to repo root).
  coverage_report_path: "coverage/coverage-summary.json"

security:
  # "none"        → no check
  # "no-high"     → block if HIGH or CRITICAL
  # "no-critical" → block only CRITICAL
  sast_threshold: "no-high"
  sca_threshold: "no-critical"
  dast_threshold: "no-critical"

docs:
  require_docs_on_feature_change: true
  paths:
    - "docs/**"
    - "ADR/**"
    - "adr/**"
    - "docs/adr/**"

supply_chain:
  require_signed_artifacts: true
  require_sbom: true
